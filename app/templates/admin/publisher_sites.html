{% extends "layout.html" %}
{% block content %}

<style>
  :root{
    --nav-min: 180px;
    --navW: max(10vw, var(--nav-min));
    --topbar-h: 72px;
  }

  .cmpx-nav{
    position: fixed;
    left:0; top:0; bottom:0;
    width: var(--navW);
    background:#303030; color:#fff;
    padding: calc(var(--topbar-h) + 8px) .5rem .75rem;
    z-index: 20;
  }
  .cmpx-nav h3{
    color:#fff; font-size:.85rem; text-transform:uppercase;
    opacity:.8; margin:.25rem .75rem;
  }
  .cmpx-nav a{
    color:#fff; display:block;
    padding:.5rem .75rem; border-radius:4px;
    text-decoration:none; font-weight:500; margin-bottom:.25rem;
  }
  .cmpx-nav a.is-active{
    color:#00cccc; background:rgba(255,255,255,.08);
  }

  .cmpx-main{
    margin-left: var(--navW);
    padding: 10px 16px 24px;
    box-sizing: border-box;
  }
</style>

<div class="cmpx-layout">
  <aside class="cmpx-nav">
    <h3>Admin</h3>
    <a href="/logs" class="{% if request.url.path.startswith('/logs') %}is-active{% endif %}">Logs</a>
    <a href="/settings" class="{% if request.url.path.startswith('/settings') %}is-active{% endif %}">Settings</a>
    <a href="/dataflow" class="{% if request.url.path.startswith('/dataflow') %}is-active{% endif %}">Data Flow</a>
    <a href="/admin/users" class="{% if request.url.path.startswith('/admin/users') %}is-active{% endif %}">Users &amp; Access</a>
    <a href="/admin/publishers" class="{% if request.url.path.startswith('/admin/publishers') %}is-active{% endif %}">Издатели</a>
  </aside>

  <main class="cmpx-main">
    <section class="section">
      <div class="level">
        <div class="level-left">
          <div>
            <h1 class="title is-4">Сайты издателя</h1>
            <p class="is-size-7 has-text-grey">
              {{ publisher.name }} (id={{ publisher.id }})
            </p>
          </div>
        </div>
        <div class="level-right">
          <a href="{{ url_for('admin_publishers_list') }}" class="button is-light is-small">
            ← Все издатели
          </a>
        </div>
      </div>

      <div class="box">
        <div class="level">
          <div class="level-left">
            <h2 class="subtitle is-6 has-text-weight-semibold">
              Сайты
            </h2>
          </div>
          <div class="level-right">
            <a href="{{ url_for('admin_new_publisher_site', publisher_id=publisher.id) }}"
               class="button is-link is-small">
              + Добавить сайт
            </a>
          </div>
        </div>

        {% if sites %}
          <table class="table is-fullwidth is-striped is-narrow">
            <thead>
              <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Домен</th>
                <th>Token</th>
                <th>Активен</th>
                <th>Код виджета</th>
              </tr>
            </thead>
            <tbody>
              {% for site in sites %}
              <tr>
                <td>{{ site.id }}</td>
                <td>{{ site.name }}</td>
                <td>{{ site.domain }}</td>
                <td><code>{{ site.public_token }}</code></td>
                <td>
                  {% if site.is_active %}
                    <span class="tag is-success is-light is-size-7">ON</span>
                  {% else %}
                    <span class="tag is-light is-size-7">OFF</span>
                  {% endif %}
                </td>
                <td style="min-width: 320px;">
                  <textarea
                    rows="7"
                    class="textarea is-size-7"
                    readonly>&lt;article&gt;
  ...контент статьи...
&lt;/article&gt;

&lt;div
  id="ai-video-widget"
  data-article-id="YOUR_ARTICLE_ID"
  data-site-token="{{ site.public_token }}"
  data-api-base="{{ request.base_url }}"
  data-article-api-base="https://article-video.your-node-backend.com"&gt;
&lt;/div&gt;

&lt;script src="{{ url_for('static', path='js/article_video_widget.js') }}" defer&gt;&lt;/script&gt;
</textarea>
                  <p class="is-size-7 has-text-grey mt-1">
                    Замените <code>YOUR_ARTICLE_ID</code> на ID статьи у издателя.
                    <br>Укажите корректный <code>data-article-api-base</code> для Node‑сервиса.
                  </p>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="has-text-grey">
            Для этого издателя пока не создано ни одного сайта.
          </p>
        {% endif %}
      </div>
    </section>
  </main>
</div>

{% endblock %}
