{% extends "layout.html" %}
{% block content %}
<style>
  :root{
    --nav-min: 180px;
    --navW: max(10vw, var(--nav-min));
    --topbar-h: 72px; /* подстройте под реальную высоту шапки */
  }

  html, body { overflow-x: hidden; }

  /* Левое меню — фиксированное, с отступом под шапку */
  .cmpx-nav{
    position: fixed; left:0; top:0; bottom:0;
    width: var(--navW);
    background:#303030; color:#fff;
    padding: calc(var(--topbar-h) + 8px) .5rem .75rem;
    z-index: 20;
  }
  .cmpx-nav h3{ color:#fff; font-size:.85rem; text-transform:uppercase; opacity:.8; margin:.25rem .75rem; }
  .cmpx-nav a{ color:#fff; display:block; padding:.5rem .75rem; border-radius:4px; text-decoration:none; font-weight:500; margin-bottom:.25rem; }
  .cmpx-nav a.is-active{ color:#00cccc; background:rgba(255,255,255,.08); }

  /* ПРАВАЯ КОЛОНКА
     1) box-sizing: border-box — ширина включает padding (КЛЮЧЕВОЕ)
     2) width на оставшуюся часть экрана, лёгкие внутренние отступы */
  .cmpx-main{
    margin-left: var(--navW);
    width: calc(90vw - var(--navW));
    padding: 5px 5px 5px;
    box-sizing: border-box;          /* <<< ключ: чтобы padding не "вылазил" за ширину */
    overflow-x: hidden;
  }

  /* Снять ограничения контейнеров Bulma внутри правой колонки */
  .cmpx-main .section, .cmpx-main .container{
    max-width: none !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    box-sizing: border-box;
  }

  /* Тулбар — чтобы не "резался", переносился и не выходил за 100% */
  #toolbar{ max-width:100%; overflow:visible; box-sizing:border-box; }
  #toolbar .field.is-grouped{ flex-wrap: wrap; gap: .5rem .5rem; } /* жёстко включаем перенос */
  #toolbar .control.is-expanded{ flex: 1 1 260px; min-width: 260px; } /* строка поиска тянется */
  #toolbar .control{ flex: 0 0 auto; } /* остальные элементы — по содержимому */

  /* Таблица может скроллиться по X, шапка липкая */
  #campaigns-table{ overflow-x:auto; overflow-y:visible; position:relative; -webkit-overflow-scrolling:touch; }
  #campaigns-table > table{ width:max-content; min-width:1200px; }
  #campaigns-table th, #campaigns-table td{ white-space:nowrap; }
  #campaigns-table td:nth-child(2){ white-space:normal; }
  #campaigns-table thead th{ position:sticky; top:0; z-index:4; background:#fff; box-shadow:0 1px 0 rgba(0,0,0,.06); }

  /* ваши компактные размеры контролов */
  #toolbar .field.is-grouped .control{ margin-right:.5rem; }
  #toolbar .field.is-grouped .control:last-child{ margin-right:0; }
  #toolbar .input.is-small, #toolbar .select.is-small select, #toolbar .button.is-small{ height:2.25em; }
  #toolbar .mb-2{ margin-bottom:.5rem; }
</style>

<div class="cmpx-layout">
  <aside class="cmpx-nav">
    <h3>Menu</h3>
    <a href="/campaigns">Campaigns</a>
    <a href="/campaigns/groups" class="is-active">Groups</a>
    <a href="/campaigns/creatives">Creatives</a>
  </aside>

  <main class="cmpx-main">
    <h2 class="title is-5">Group #{{ group.id }} — {{ group.name }}</h2>
    <p class="mb-2">Members: {{ members|join(', ') }}</p>

    <table class="table is-striped is-fullwidth">
      <thead>
        <tr>
          <th>Date</th>
          <th>Impressions</th>
          <th>Clicks</th>
          <th>Reach</th>
          <th>CTR</th>
          <th>Frequency</th>
          <th>VTR</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.date }}</td>
          <td>{{ r.impr or 0 }}</td>
          <td>{{ r.clk  or 0 }}</td>
          <td>{{ r.reach or 0 }}</td>
          <td>{{ "%.2f%%"|format(r.ctr*100) if r.ctr is not none else "—" }}</td>
          <td>{{ "%.2f"|format(r.freq) if r.freq is not none else "—" }}</td>
          <td>{{ "%.2f%%"|format(r.vtr*100) if r.vtr is not none else "—" }}</td>
        </tr>
        {% endfor %}
        {% if not rows %}
        <tr><td colspan="7">No daily data.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </main>
</div>
{% endblock %}
